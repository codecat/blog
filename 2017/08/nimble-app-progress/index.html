<!DOCTYPE html>
<html lang="en-US">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width">

		
			<title>Implementing a stylesheet system is hard - Codecat - Scribblings of a programatrickerist.</title>
		

		<meta name="theme-color" content="#a7eb47">
		<meta property="og:title" content="Implementing a stylesheet system is hard">
		<meta property="og:type" content="website">
		<meta property="og:url" content="https://codecat.nl/2017/08/nimble-app-progress/">
		
		
			<meta property="og:description" content="It&#x27;s difficult to implement a stylesheet system; a small progress report on my experimental application framework.">
		

		<link rel="stylesheet" href="/pure.css">
		<link rel="stylesheet" href="/style.css">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css" integrity="sha256-XoaMnoYC5TH6/+ihMEnospgm0J1PM/nioxbOUdnM8HY=" crossorigin="anonymous">
	</head>

	<body>
		<header>
			<h1><a href="/">Codecat.nl</a></h1>
			<p class="social">
				<a rel="me noopener noreferrer" href="https://meow.social/@codecat" title="Mastodon" target="_blank"><i class="fa fa-mastodon" aria-hidden="true"></i></a>
				<a rel="me noopener noreferrer" href="https://github.com/codecat" title="GitHub" target="_blank"><i class="fa fa-github" aria-hidden="true"></i></a>
				<a rel="me noopener noreferrer" href="https://nimble.itch.io" title="Itch" target="_blank"><i class="fa fa-gamepad" aria-hidden="true"></i></a>
				<a rel="me noopener noreferrer" href="https://twitch.tv/missterious" title="Twitch" target="_blank"><i class="fa fa-twitch" aria-hidden="true"></i></a>
				<a rel="me noopener noreferrer" href="https://soundcloud.com/codecatt" title="SoundCloud" target="_blank"><i class="fa fa-soundcloud" aria-hidden="true"></i></a>
			</p>
		</header>

		<div class="container">
			
	<article class="pure-g">
		<div class="pure-u-1">
			<h1>Implementing a stylesheet system is hard</h1>
			<p class="subtitle">
				<i class="fa fa-calendar" aria-hidden="true"></i>
				Posted on 2017-08-02
			</p>
			<div class="content">
				<p>It has been exactly 1 month since <a href="/hardware-accelerated-application-framework">my last blogpost on Nimble Application Framework</a>. In the past month I've been working on and off, particularly on stylesheet experimentation; which I have decided to cut for the time being.</p>
<p>There's also a new localization system for translating strings into different languages, and a new &quot;page&quot; system.</p>
<span id="continue-reading"></span>
<p>While implementing stylesheets, I asked myself a few questions:</p>
<ul>
<li>What syntax would stylesheet files use?</li>
<li>How would selectors work?</li>
<li>How would I efficiently set all values without duplicating code?</li>
</ul>
<p>The first 2 points were simple. I adapted an ini-like format where sections are selector strings, keys are property names and values are property values. Pretty straight forward. (This ini parsing ended up coming in useful for localization as well.)</p>
<p>Next, we have the selectors. I decided I wanted something similar to CSS, where you can select by ID, classname, tag name, or both; so I ended up writing a parser for these selectors. The selector is &quot;compiled&quot;, and then matched with all widgets. It also allows to chain children of widgets together, so that selectors can be more narrow in their search.</p>
<pre data-lang="ini" style="background-color:#212121;color:#eeffff;" class="language-ini "><code class="language-ini" data-lang="ini"><span style="font-style:italic;color:#c792ea;">[#test button]
</span><span style="color:#f78c6c;">margin </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">5
</span></code></pre>
<p>Now it looks like there's a very clear path on how to continueu; let's actually apply the styles on the widgets now. This ended up being more difficult than I was expecting, because I didn't want to clog the code with a bunch of string comparisons for property names, essentially duplicating what I already have for main attribute loading.</p>
<p>This led me into researching the giant rabbithole that is autogenerated code. In the end I decided against doing this, although I did make some progress on <a href="https://github.com/nimbletools/codegen">a Go-based reflection-style code generator for C++ classes</a>. So instead of doing that, the next obvious step to me would be to implement widgets in some kind of scripting language instead of purely C++. That way, you can dynamically set widget properties by name. The language needs to be very fast, as it would be rendering/updating a lot of different kinds of (big) widgets. The best solution I saw was to try implementing an embedded Mono .Net runtime.</p>
<p>The <a href="https://github.com/nimbletools/nimble-app/tree/dotnet">dotnet branch on Github</a> shows the progress made there. Unfortunately, it ended up being a huge amount of work (much more than I was hoping), so I gave up on that as well for the time being. I don't want to rule out using C# just yet (it's a good idea for embedded scripting), but for now I've cut all of the stylesheet stuff as it became too much of a burden, and I wasn't getting anywhere in terms of progress.</p>
<p>So, despite having to cut the stylesheets for now, let's move on!</p>
<p>Localization was added, which is (as previously mentioned) aided by the ini file format. Whenever strings are used such as <code>##Section.Key</code>, it will be replaced with the loaded localized string, if it exists.</p>
<pre data-lang="ini" style="background-color:#212121;color:#eeffff;" class="language-ini "><code class="language-ini" data-lang="ini"><span style="font-style:italic;color:#c792ea;">[Main]
</span><span style="color:#f78c6c;">Title </span><span style="color:#89ddff;">=</span><span> Nimble App Example
</span><span style="color:#f78c6c;">CreateBlock </span><span style="color:#89ddff;">=</span><span> Create block
</span><span style="color:#f78c6c;">InvalidateLayout </span><span style="color:#89ddff;">=</span><span> Invalidate layout
</span><span style="color:#f78c6c;">ResizeWindow </span><span style="color:#89ddff;">=</span><span> Resize window
</span></code></pre>
<p>The latest (and important) addition is the introduction of &quot;pages&quot;. Typically, big applications use multiple interfaces in which they operate. A page in Nimble App is a full-window container that draws and handles input individually. This lets you make interface stacks like open file dialogs, messageboxes, or any other full-sized interface.</p>
<p><img src="/2017/08/NimbleAppMessagebox.png" alt="" /></p>
<p>As always, you can check the latest code on <a href="https://github.com/nimbletools/nimble-app/">Github</a>.</p>

			</div>

			<div class="page-footer">
				<p><b>Like my work?</b></p>
				<p>You can <a href="https://meow.social/@codecat" rel="me noopener" target="blank">follow me on Mastodon</a> or <a href="https://www.patreon.com/openplanet" rel="noopener" target="blank">sponsor me on Patreon</a>.</p>
			</div>
		</div>
	</article>

		</div>

		<footer>
			&copy; Melissa Geels 2024
		</footer>
	</body>
</html>
